// @see : http://www.webbricks.org/lazyLoad/
Array.prototype.each=function(a){for(var b=0,c=this.length;b<c;b++){a.apply(this,[this[b],b])}return this};function addEvent(a,b,c,d){if(a.addEventListener){a.addEventListener(b,c,d)}else{a.attachEvent("on"+b,c)}}function coll2arr(a){var b=[],c=0,d;a=a||[];if(a.tagName){a=[a]}for(d=a.length;c<d;c++){b[c]=a[c]}return b}function getPos(a){var b={'r':0,'l':0,'t':0,'b':0},c=a;do{b.l+=c.offsetLeft;c=c.offsetParent}while(c!==null);b.r=b.l+a.offsetWidth;c=a;do{b.t+=c.offsetTop;c=c.offsetParent}while(c!==null);b.b=b.t+a.offsetHeight;return b}function inRange(a,b,c,d,e){d=d===undefined?c:d;if(e){return(a<=c)&&(b>=d)}else{return((a<=c)&&(b>=c))||((a<=d)&&(b>=d))}}function scrolled(){var a,b,c=window,d=document,e=d.documentElement,f=d.body;if(c.pageXOffset!==undefined){a=c.pageXOffset;b=c.pageYOffset}else{a=e.scrollLeft?e.scrollLeft:(f.scrollLeft?f.scrollLeft:0);b=e.scrollTop?e.scrollTop:(f.scrollTop?f.scrollTop:0)}return{'x':a,'y':b}}function transfer(a,b){var c,d={};for(c in b){d[c]=b[c]}for(c in a){d[c]=a[c]}return d}function winDim(){var a,b,c=window,d=document,e=d.documentElement,f=d.body;if(c.innerWidth){a=c.innerWidth;b=c.innerHeight}else if(e.clientWidth){a=e.clientWidth;b=e.clientHeight}else{a=f.clientWidth;b=f.clientHeight}return{'w':a,'h':b}}var lazyLoad={def:{targets:document.getElementsByTagName('img'),onPostpone:0,onRecall:0,tolerance:300},isVisible:function(a,b){return inRange(scrolled().y-b,scrolled().y+winDim().h+b,getPos(a).t,getPos(a).b)},init:function(b){var c=this,d,e=[];b=transfer(b,this.def);b.targets=coll2arr(b.targets);b.targets.each(function(a){if(!c.isVisible(a,b.tolerance)){e.push(a);a.recSrc=a.src;a.src='';if(b.onPostpone){b.onPostpone.apply(a)}}});b.targets=e;c.recall(b)},recall:function(c){var d=this,e=[],f=[],g;c.targets.each(function(a,b){if(a&&a.recSrc&&d.isVisible(a,c.tolerance)){if(c.onRecall){addEvent(a,'load',function(){c.onRecall.apply(a)})}a.src=a.recSrc;a.recSrc='';f[b]=1}});c.targets.each(function(a,b){if(!(b in f))e.push(a)});c.targets=e;if(c.targets.length){setTimeout(function(){d.recall(c)},100)}}};